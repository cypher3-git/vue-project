# 用户登录问题排查指南

## 🔧 问题解决步骤

如果在登录页面点击预设用户按钮时出现"用户不存在"的错误，请按以下步骤操作：

### 步骤1：打开浏览器控制台
按 `F12` 打开开发者工具，切换到 `Console` 标签页

### 步骤2：使用调试工具
在登录页面底部找到 **"调试工具"** 区域，按顺序点击：

1. **🔄 重置数据** - 清除所有缓存数据并重新初始化
2. **👤 查看状态** - 在控制台查看当前用户数据库状态
3. **🧪 测试登录** - 自动测试登录张三用户

### 步骤3：检查控制台输出
查看控制台中的日志信息：

#### 正常情况应该看到：
```
🔍 检查数据库状态...
✅ 数据库已正确初始化
👥 患者数量: 4
👨‍⚕️ 医生数量: 4
```

#### 如果看到异常：
```
⚠️ 数据库为空或异常，开始初始化...
✅ 数据库初始化成功
```

### 步骤4：重新尝试登录
数据重置后，再次点击任意预设用户按钮进行登录。

## 🐛 常见问题

### 问题1：点击用户按钮后提示"患者用户不存在"
**原因**: 用户数据库未正确初始化
**解决**: 点击 "🔄 重置数据" 按钮

### 问题2：点击用户按钮后提示"医生用户不存在"  
**原因**: 用户数据库未正确初始化
**解决**: 点击 "🔄 重置数据" 按钮

### 问题3：页面加载后数据库为空
**原因**: LocalStorage缓存问题
**解决**: 
1. 刷新页面
2. 清除浏览器缓存
3. 点击 "🔄 重置数据" 按钮

## 📊 预设用户列表

### 患者用户 (4个)
- `patient_cardio_001` - 张三 (心血管科)
- `patient_cardio_002` - 李四 (心血管科)
- `patient_respiratory_001` - 王五 (呼吸内科)
- `patient_respiratory_002` - 赵六 (呼吸内科)

### 医生用户 (4个)
- `doctor_cardio_001` - 刘医生 (心血管科)
- `doctor_cardio_002` - 陈医生 (心血管科)
- `doctor_respiratory_001` - 吴医生 (呼吸内科)
- `doctor_respiratory_002` - 周医生 (呼吸内科)

## 🔍 高级调试

### 在控制台手动检查数据：

```javascript
// 查看用户数据库
console.log('用户数据库:', JSON.parse(localStorage.getItem('mock_user_database')))

// 查看当前用户
console.log('当前用户:', JSON.parse(localStorage.getItem('user')))

// 手动切换用户
mockBackend.switchUser('patient_cardio_001', 'patient')

// 获取所有用户
mockBackend.getAllUsers().then(response => {
  console.log('所有用户:', response.data)
})
```

### 完全重置系统：
```javascript
// 清除所有数据
['token', 'user', 'mock_user_database', 'mock_medical_files', 
 'mock_authorization_requests', 'mock_access_records'].forEach(key => {
  localStorage.removeItem(key)
})

// 刷新页面
location.reload()
```

## ✅ 验证修复

成功修复后，您应该能够：

1. ✅ 点击任意预设用户按钮正常登录
2. ✅ 看到对应用户的欢迎消息
3. ✅ 正确跳转到对应的页面（患者→数据页面，医生→数据管理页面）
4. ✅ 在页面右上角看到正确的用户名称

## 🆘 仍然有问题？

如果按照上述步骤仍然无法解决问题，请：

1. 完全关闭浏览器重新打开
2. 尝试使用隐私/无痕模式
3. 清除浏览器所有缓存和Cookie
4. 检查浏览器控制台是否有其他JavaScript错误

现在系统应该能够正常工作了！🎉
