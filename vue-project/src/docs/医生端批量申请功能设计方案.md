# ğŸ”„ åŒ»ç”Ÿç«¯æ‰¹é‡ç”³è¯·åŠŸèƒ½è®¾è®¡æ–¹æ¡ˆ

## ğŸ¯ åŠŸèƒ½éœ€æ±‚åˆ†æ

### **æ ¸å¿ƒéœ€æ±‚**
- åœ¨åŒ»ç”Ÿç«¯æ•°æ®ç®¡ç†é¡µé¢æ·»åŠ ã€æ‰¹é‡ç”³è¯·ã€‘æŒ‰é’®
- ç‚¹å‡»åè‡ªåŠ¨è¯†åˆ«æ‰€æœ‰"æœªç”³è¯·"çŠ¶æ€çš„æ•°æ®
- æ‰¹é‡å‘èµ·æˆæƒç”³è¯·ï¼Œç®€åŒ–åŒ»ç”Ÿæ“ä½œæµç¨‹

### **ç”¨æˆ·åœºæ™¯**
```
åŒ»ç”Ÿç™»å½• â†’ æ•°æ®ç®¡ç†é¡µé¢ â†’ æŸ¥çœ‹å¤šä¸ªæœªç”³è¯·çš„æ•°æ® â†’ ç‚¹å‡»ã€æ‰¹é‡ç”³è¯·ã€‘â†’ 
å¡«å†™ç»Ÿä¸€çš„ç”³è¯·ç†ç”±å’Œä½¿ç”¨ç›®çš„ â†’ æ‰¹é‡æäº¤ç”³è¯· â†’ ç­‰å¾…æ‚£è€…å®¡æ‰¹
```

## ğŸ¨ UIè®¾è®¡æ–¹æ¡ˆ

### **1. æ‰¹é‡ç”³è¯·æŒ‰é’®ä½ç½®**
```vue
<!-- é¡µé¢æ ‡é¢˜å’Œæ“ä½œåŒº -->
<div class="page-header">
  <h2>æ•°æ®ç®¡ç†</h2>
  <div class="header-actions">
    <el-button 
      type="primary" 
      @click="openBatchApplyDialog"
      :disabled="!hasUnrequestedData"
    >
      <el-icon><Document /></el-icon>
      æ‰¹é‡ç”³è¯·
    </el-button>
    <el-button @click="refreshData" :loading="loading">
      <el-icon><Refresh /></el-icon>
      åˆ·æ–°
    </el-button>
  </div>
</div>
```

### **2. æ‰¹é‡ç”³è¯·å¯¹è¯æ¡†**
```vue
<el-dialog v-model="batchApplyDialogVisible" title="æ‰¹é‡æˆæƒç”³è¯·" width="700px">
  <div class="batch-apply-content">
    <!-- ç”³è¯·æ•°æ®åˆ—è¡¨ -->
    <el-alert
      title="å°†å¯¹ä»¥ä¸‹æœªç”³è¯·çš„æ•°æ®å‘èµ·æˆæƒç”³è¯·"
      type="info"
      :closable="false"
      style="margin-bottom: 20px;"
    />
    
    <div class="data-preview">
      <el-tag v-for="data in unrequestedDataList" :key="data.id" style="margin: 4px;">
        {{ data.title }}
      </el-tag>
      <div class="data-count">å…± {{ unrequestedDataList.length }} æ¡æ•°æ®</div>
    </div>
    
    <!-- ç»Ÿä¸€ç”³è¯·è¡¨å• -->
    <el-form :model="batchApplyForm" :rules="batchApplyRules" label-width="100px">
      <el-form-item label="ç”³è¯·ç†ç”±" prop="reason">
        <el-input
          v-model="batchApplyForm.reason"
          type="textarea"
          :rows="4"
          placeholder="è¯·è¯´æ˜éœ€è¦æŸ¥çœ‹è¿™äº›æ•°æ®çš„ç†ç”±"
        />
      </el-form-item>
      
      <el-form-item label="ä½¿ç”¨ç›®çš„" prop="purpose">
        <el-select v-model="batchApplyForm.purpose" placeholder="è¯·é€‰æ‹©ä½¿ç”¨ç›®çš„">
          <el-option label="è¯Šæ–­æ²»ç–—" value="è¯Šæ–­æ²»ç–—" />
          <el-option label="ç—…æƒ…è¯„ä¼°" value="ç—…æƒ…è¯„ä¼°" />
          <el-option label="åŒ»å­¦ç ”ç©¶" value="åŒ»å­¦ç ”ç©¶" />
          <el-option label="ä¼šè¯Šå’¨è¯¢" value="ä¼šè¯Šå’¨è¯¢" />
          <el-option label="å…¶ä»–" value="å…¶ä»–" />
        </el-select>
      </el-form-item>
    </el-form>
  </div>
  
  <template #footer>
    <div class="dialog-footer">
      <el-button @click="batchApplyDialogVisible = false">å–æ¶ˆ</el-button>
      <el-button 
        type="primary" 
        @click="submitBatchApply" 
        :loading="batchSubmitting"
      >
        æäº¤ç”³è¯· ({{ unrequestedDataList.length }}æ¡)
      </el-button>
    </div>
  </template>
</el-dialog>
```

## ğŸ’» æŠ€æœ¯å®ç°æ–¹æ¡ˆ

### **1. æ•°æ®çŠ¶æ€ç®¡ç†**

#### **æ·»åŠ æ–°çš„å“åº”å¼æ•°æ®**
```typescript
// æ‰¹é‡ç”³è¯·ç›¸å…³çŠ¶æ€
const batchApplyDialogVisible = ref(false)
const batchSubmitting = ref(false)
const batchApplyForm = ref({
  reason: '',
  purpose: ''
})

// è¡¨å•éªŒè¯è§„åˆ™
const batchApplyRules = ref({
  reason: [
    { required: true, message: 'è¯·è¾“å…¥ç”³è¯·ç†ç”±', trigger: 'blur' },
    { min: 10, message: 'ç”³è¯·ç†ç”±è‡³å°‘10ä¸ªå­—ç¬¦', trigger: 'blur' }
  ],
  purpose: [
    { required: true, message: 'è¯·é€‰æ‹©ä½¿ç”¨ç›®çš„', trigger: 'change' }
  ]
})
```

#### **è®¡ç®—æœªç”³è¯·æ•°æ®**
```typescript
// è·å–æ‰€æœ‰æœªç”³è¯·çš„æ•°æ®
const unrequestedDataList = computed(() => {
  return dataList.value.filter(data => 
    data.authStatus === 'not-requested' || data.authStatus === 'rejected'
  )
})

// æ£€æŸ¥æ˜¯å¦æœ‰æœªç”³è¯·çš„æ•°æ®
const hasUnrequestedData = computed(() => {
  return unrequestedDataList.value.length > 0
})
```

### **2. æ ¸å¿ƒä¸šåŠ¡é€»è¾‘**

#### **æ‰“å¼€æ‰¹é‡ç”³è¯·å¯¹è¯æ¡†**
```typescript
const openBatchApplyDialog = () => {
  if (unrequestedDataList.value.length === 0) {
    ElMessage.warning('å½“å‰æ²¡æœ‰éœ€è¦ç”³è¯·çš„æ•°æ®')
    return
  }
  
  // é‡ç½®è¡¨å•
  batchApplyForm.value = {
    reason: '',
    purpose: ''
  }
  
  batchApplyDialogVisible.value = true
}
```

#### **æ‰¹é‡æäº¤ç”³è¯·**
```typescript
const submitBatchApply = async () => {
  if (!batchApplyFormRef.value) return
  
  try {
    await batchApplyFormRef.value.validate()
    
    batchSubmitting.value = true
    
    const { doctorApi } = await import('@/api')
    const reason = `${batchApplyForm.value.reason}\nä½¿ç”¨ç›®çš„ï¼š${batchApplyForm.value.purpose}`
    
    // æ‰¹é‡å‘é€ç”³è¯·
    const promises = unrequestedDataList.value.map(data => 
      doctorApi.requestAuthorization(data.id, reason)
    )
    
    const results = await Promise.allSettled(promises)
    
    // ç»Ÿè®¡ç»“æœ
    const successCount = results.filter(result => 
      result.status === 'fulfilled' && result.value.success
    ).length
    
    const failureCount = results.length - successCount
    
    // æ˜¾ç¤ºç»“æœ
    if (successCount === results.length) {
      ElMessage.success(`æ‰¹é‡ç”³è¯·æˆåŠŸï¼å…±æäº¤ ${successCount} æ¡ç”³è¯·`)
    } else if (successCount > 0) {
      ElMessage.warning(`éƒ¨åˆ†ç”³è¯·æˆåŠŸï¼š${successCount} æ¡æˆåŠŸï¼Œ${failureCount} æ¡å¤±è´¥`)
    } else {
      ElMessage.error(`æ‰¹é‡ç”³è¯·å¤±è´¥ï¼š${failureCount} æ¡ç”³è¯·æäº¤å¤±è´¥`)
    }
    
    batchApplyDialogVisible.value = false
    
    // é‡æ–°åŠ è½½æ•°æ®åˆ—è¡¨
    await loadDataList()
    
  } catch (error: any) {
    if (error !== 'cancel') {
      console.error('æ‰¹é‡ç”³è¯·å¤±è´¥:', error)
      ElMessage.error('æ‰¹é‡ç”³è¯·å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥')
    }
  } finally {
    batchSubmitting.value = false
  }
}
```

### **3. è¿›åº¦æŒ‡ç¤ºä¼˜åŒ–**

#### **å¸¦è¿›åº¦çš„æ‰¹é‡ç”³è¯·**
```typescript
const submitBatchApplyWithProgress = async () => {
  try {
    batchSubmitting.value = true
    
    const totalCount = unrequestedDataList.value.length
    let completedCount = 0
    let successCount = 0
    
    // åˆ›å»ºè¿›åº¦æç¤º
    const progressMessage = ElMessage({
      message: `æ­£åœ¨æäº¤ç”³è¯·... 0/${totalCount}`,
      type: 'info',
      duration: 0
    })
    
    // é€ä¸ªæäº¤ç”³è¯·
    for (const data of unrequestedDataList.value) {
      try {
        const response = await doctorApi.requestAuthorization(data.id, reason)
        if (response.success) {
          successCount++
        }
      } catch (error) {
        console.error(`ç”³è¯· ${data.title} å¤±è´¥:`, error)
      }
      
      completedCount++
      
      // æ›´æ–°è¿›åº¦
      progressMessage.close()
      progressMessage = ElMessage({
        message: `æ­£åœ¨æäº¤ç”³è¯·... ${completedCount}/${totalCount}`,
        type: 'info',
        duration: 0
      })
    }
    
    progressMessage.close()
    
    // æ˜¾ç¤ºæœ€ç»ˆç»“æœ
    showBatchApplyResult(successCount, totalCount - successCount)
    
  } catch (error) {
    ElMessage.error('æ‰¹é‡ç”³è¯·è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯')
  } finally {
    batchSubmitting.value = false
  }
}
```

## ğŸ¨ UI/UX ä¼˜åŒ–

### **1. è§†è§‰å±‚æ¬¡è®¾è®¡**

#### **æŒ‰é’®çŠ¶æ€**
```scss
.header-actions {
  display: flex;
  gap: 12px;
  
  .batch-apply-btn {
    &:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .batch-count {
      background: rgba(255, 255, 255, 0.2);
      border-radius: 10px;
      padding: 2px 6px;
      font-size: 12px;
      margin-left: 4px;
    }
  }
}
```

#### **æ•°æ®é¢„è§ˆæ ·å¼**
```scss
.data-preview {
  background: #f8f9fa;
  border-radius: 8px;
  padding: 16px;
  margin-bottom: 20px;
  max-height: 200px;
  overflow-y: auto;
  
  .el-tag {
    margin: 2px 4px 2px 0;
  }
  
  .data-count {
    margin-top: 12px;
    font-size: 14px;
    color: #606266;
    font-weight: 500;
  }
}
```

### **2. äº¤äº’åé¦ˆè®¾è®¡**

#### **åŠ è½½çŠ¶æ€**
```vue
<el-button 
  type="primary" 
  @click="submitBatchApply"
  :loading="batchSubmitting"
>
  <template v-if="batchSubmitting">
    <el-icon><Loading /></el-icon>
    æäº¤ä¸­...
  </template>
  <template v-else>
    æäº¤ç”³è¯· ({{ unrequestedDataList.length }}æ¡)
  </template>
</el-button>
```

#### **ç»“æœæç¤º**
```typescript
const showBatchApplyResult = (successCount: number, failureCount: number) => {
  const totalCount = successCount + failureCount
  
  if (successCount === totalCount) {
    ElNotification({
      title: 'æ‰¹é‡ç”³è¯·æˆåŠŸ',
      message: `æˆåŠŸæäº¤ ${successCount} æ¡æˆæƒç”³è¯·ï¼Œè¯·ç­‰å¾…æ‚£è€…å®¡æ‰¹`,
      type: 'success',
      duration: 5000
    })
  } else if (successCount > 0) {
    ElNotification({
      title: 'æ‰¹é‡ç”³è¯·éƒ¨åˆ†æˆåŠŸ',
      message: `${successCount} æ¡ç”³è¯·æˆåŠŸï¼Œ${failureCount} æ¡ç”³è¯·å¤±è´¥ï¼Œè¯·æ£€æŸ¥å¤±è´¥é¡¹ç›®å¹¶é‡è¯•`,
      type: 'warning',
      duration: 8000
    })
  } else {
    ElNotification({
      title: 'æ‰¹é‡ç”³è¯·å¤±è´¥',
      message: `æ‰€æœ‰ ${failureCount} æ¡ç”³è¯·éƒ½å¤±è´¥äº†ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–è”ç³»ç®¡ç†å‘˜`,
      type: 'error',
      duration: 10000
    })
  }
}
```

## ğŸ“± å“åº”å¼è®¾è®¡

### **ç§»åŠ¨ç«¯é€‚é…**
```scss
@media (max-width: 768px) {
  .page-header {
    flex-direction: column;
    gap: 12px;
    
    .header-actions {
      width: 100%;
      justify-content: space-between;
      
      .el-button {
        flex: 1;
        max-width: 150px;
      }
    }
  }
  
  .batch-apply-dialog {
    width: 95% !important;
    margin: 5vh auto;
    
    .data-preview {
      max-height: 120px;
    }
  }
}
```

## ğŸ§ª æµ‹è¯•åœºæ™¯

### **åŠŸèƒ½æµ‹è¯•ç”¨ä¾‹**

#### **æ­£å¸¸æµç¨‹**
1. âœ… é¡µé¢åŠ è½½åæ˜¾ç¤ºæ‰¹é‡ç”³è¯·æŒ‰é’®
2. âœ… æœ‰æœªç”³è¯·æ•°æ®æ—¶æŒ‰é’®å¯ç”¨ï¼Œæ— æ•°æ®æ—¶ç¦ç”¨
3. âœ… ç‚¹å‡»æŒ‰é’®æ‰“å¼€æ‰¹é‡ç”³è¯·å¯¹è¯æ¡†
4. âœ… å¯¹è¯æ¡†æ˜¾ç¤ºæ‰€æœ‰æœªç”³è¯·çš„æ•°æ®åˆ—è¡¨
5. âœ… å¡«å†™ç”³è¯·ç†ç”±å’Œä½¿ç”¨ç›®çš„
6. âœ… æäº¤æ‰¹é‡ç”³è¯·å¹¶æ˜¾ç¤ºè¿›åº¦
7. âœ… ç”³è¯·å®Œæˆååˆ·æ–°æ•°æ®åˆ—è¡¨

#### **è¾¹ç¼˜æƒ…å†µ**
1. âœ… æ— æœªç”³è¯·æ•°æ®æ—¶çš„å¤„ç†
2. âœ… ç½‘ç»œé”™è¯¯æ—¶çš„é‡è¯•æœºåˆ¶
3. âœ… éƒ¨åˆ†ç”³è¯·å¤±è´¥æ—¶çš„å¤„ç†
4. âœ… è¡¨å•éªŒè¯å¤±è´¥æ—¶çš„æç¤º
5. âœ… å¹¶å‘ç”³è¯·çš„é˜²é‡å¤æäº¤

#### **æ€§èƒ½æµ‹è¯•**
1. âœ… å¤§é‡æ•°æ®æ—¶çš„æ‰¹é‡ç”³è¯·æ€§èƒ½
2. âœ… å¹¶å‘è¯·æ±‚çš„å¤„ç†èƒ½åŠ›
3. âœ… å†…å­˜å ç”¨å’ŒUIå“åº”æ€§

## ğŸ“‹ å®æ–½è®¡åˆ’

### **Phase 1: åŸºç¡€åŠŸèƒ½** (é¢„ä¼°: 2-3å°æ—¶)
- [ ] æ·»åŠ æ‰¹é‡ç”³è¯·æŒ‰é’®
- [ ] å®ç°è·å–æœªç”³è¯·æ•°æ®çš„è®¡ç®—å±æ€§
- [ ] åˆ›å»ºæ‰¹é‡ç”³è¯·å¯¹è¯æ¡†

### **Phase 2: æ ¸å¿ƒé€»è¾‘** (é¢„ä¼°: 2-3å°æ—¶)
- [ ] å®ç°æ‰¹é‡æˆæƒç”³è¯·APIè°ƒç”¨
- [ ] æ·»åŠ è¡¨å•éªŒè¯å’Œé”™è¯¯å¤„ç†
- [ ] å®Œå–„æ•°æ®çŠ¶æ€ç®¡ç†

### **Phase 3: ç”¨æˆ·ä½“éªŒ** (é¢„ä¼°: 1-2å°æ—¶)
- [ ] æ·»åŠ è¿›åº¦æŒ‡ç¤ºå’ŒåŠ è½½çŠ¶æ€
- [ ] ä¼˜åŒ–äº¤äº’åé¦ˆå’Œé€šçŸ¥
- [ ] å®Œå–„æ ·å¼å’Œå“åº”å¼è®¾è®¡

### **Phase 4: æµ‹è¯•ä¼˜åŒ–** (é¢„ä¼°: 1å°æ—¶)
- [ ] åŠŸèƒ½æµ‹è¯•å’Œè¾¹ç¼˜æƒ…å†µå¤„ç†
- [ ] æ€§èƒ½ä¼˜åŒ–å’Œä»£ç é‡æ„
- [ ] æ–‡æ¡£å®Œå–„å’Œä»£ç æ³¨é‡Š

## ğŸ¯ é¢„æœŸæ•ˆæœ

### **ç”¨æˆ·ä»·å€¼**
- ğŸš€ **æ•ˆç‡æå‡**: ä¸€é”®ç”³è¯·å¤šä¸ªæ•°æ®ï¼Œå‡å°‘é‡å¤æ“ä½œ
- ğŸ¯ **ä½“éªŒä¼˜åŒ–**: ç»Ÿä¸€çš„ç”³è¯·ç†ç”±ï¼Œç®€åŒ–å¡«å†™æµç¨‹
- ğŸ“Š **çŠ¶æ€é€æ˜**: æ¸…æ™°çš„è¿›åº¦æç¤ºå’Œç»“æœåé¦ˆ

### **æŠ€æœ¯ä»·å€¼**
- ğŸ§¹ **ä»£ç å¤ç”¨**: åŸºäºç°æœ‰å•ä¸ªç”³è¯·é€»è¾‘æ‰©å±•
- ğŸ›¡ï¸ **é”™è¯¯å¤„ç†**: å®Œå–„çš„å¼‚å¸¸å¤„ç†å’Œé‡è¯•æœºåˆ¶
- ğŸ“± **å“åº”å¼**: é€‚é…å„ç§è®¾å¤‡å’Œå±å¹•å°ºå¯¸

### **ä¸šåŠ¡ä»·å€¼**  
- ğŸ“ˆ **ä½¿ç”¨æ•ˆç‡**: æé«˜åŒ»ç”Ÿä½¿ç”¨ç³»ç»Ÿçš„æ•ˆç‡
- ğŸ’¡ **ç”¨æˆ·æ»¡æ„åº¦**: å‡å°‘é‡å¤æ“ä½œï¼Œæå‡ç”¨æˆ·ä½“éªŒ
- ğŸ”„ **æµç¨‹ä¼˜åŒ–**: ç®€åŒ–æˆæƒç”³è¯·æµç¨‹

è¿™ä¸ªæ‰¹é‡ç”³è¯·åŠŸèƒ½å°†å¤§å¤§æå‡åŒ»ç”Ÿç«¯çš„ä½¿ç”¨ä½“éªŒï¼Œè®©åŒ»ç”Ÿèƒ½å¤Ÿæ›´é«˜æ•ˆåœ°ç”³è¯·å¤šä¸ªæ•°æ®çš„æˆæƒï¼ğŸ‰
